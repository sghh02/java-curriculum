# データベースアクセス

このUnitでは、JDBCで「DBに接続してSQLを実行する」を体験します。
次の章（制作物：ToDo管理のDB対応）で使う前準備です。

## ゴール

- H2などのローカルDBを用意できる
- JDBC URL / user / password の意味を説明できる
- SQLでCRUD（SELECT/INSERT/UPDATE/DELETE）ができる
- `PreparedStatement` を使う理由を説明できる（SQLインジェクション対策）

## 準備（H2を想定）

このカリキュラムでは軽量なH2を推奨します。

- JDBC URL（例）：`jdbc:h2:file:./data/todo`
- user：`sa`
- password：空文字（`""`）

※`./data` ディレクトリが存在しない場合は、作成するか、別の保存先に変更してください。

### JDBCドライバ（H2）を追加する

プロジェクトの種類やIDEで手順が変わるので、ここはAIに聞いてOKです。
次をコピペして、自分の環境に置き換えてください。

```text
JavaのプロジェクトにH2 DatabaseのJDBCドライバを追加したいです。
環境は（IntelliJ/Eclipse/VS Code）で、ビルドは（Maven/Gradle/なし）です。
`java -version` は（結果）です。
最短手順と、追加後に接続確認する最小コードを教えてください。
```

## ToDo用テーブルを作成する（次章で使用）

次章（制作物）では、この `TASKS` テーブルにToDoを保存します。
DBに次のテーブルを作成してください（H2の例）。

```sql
CREATE TABLE TASKS (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  TITLE VARCHAR(100) NOT NULL,
  COMPLETED BOOLEAN NOT NULL,
  CREATED_AT TIMESTAMP NOT NULL,
  UPDATED_AT TIMESTAMP NOT NULL
);
```

動作確認用に、数件INSERTしておくと確認が楽です（例）。

```sql
INSERT INTO TASKS (TITLE, COMPLETED, CREATED_AT, UPDATED_AT)
VALUES ('buy milk', FALSE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
```

## 練習問題

### 練習問題1：Task クラスを作る

`TASKS` テーブルの1行を表す `Task` クラスを作ってください。

- フィールドは列に対応（例：`id`, `title`, `completed`, `createdAt`, `updatedAt`）
- getter/setter を用意する（命名は好みでOK）

### 練習問題2：TasksDAO を作る

次の `Main` が動くように、`TasksDAO` を作ってください。
まずは `findAll()` だけでOKです。

```java
import java.util.List;

public class Main {
    public static void main(String[] args) {
        List<Task> tasks = TasksDAO.findAll();
        for (Task task : tasks) {
            System.out.println(task.getId() + ": " + task.getTitle());
        }
    }
}
```

- SQLは `SELECT ID, TITLE, COMPLETED, CREATED_AT, UPDATED_AT FROM TASKS ORDER BY ID`
- 文字列連結でSQLを作らず、`PreparedStatement` を使う

## AIに質問する（この章の例）

次の例をそのままAIに投げてOKです（必要なら自分のコード/エラーに置き換えてください）。

```text
「『データベースアクセス』を初心者向けに、たとえ話つきで説明して。最後に要点を3つにまとめて」
「この章の内容で理解確認クイズを5問作って（解答は最後にまとめて）」
「この章の練習問題で詰まった。答えを丸ごとではなく、方針→ヒント→確認質問の順で教えて」
「SQLインジェクションを、悪い例→良い例（PreparedStatement）で説明して」
```

---

## 課題提出

この章には提出課題があります。

1. 上記の練習問題を完了する
2. GitHub で `feature/34-external-database-access` ブランチを作成し、PRを作成
3. [AI総合レビューツール](https://ai.studio/apps/drive/1AMqIqU4Bio4te7AWh5dly1Qzp7CesqP9?fullscreenApplet=true) でレビューを実行
4. 問題がなければ、スプレッドシートに **PR URL** と **完了日** を記入
